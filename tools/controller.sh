#!/bin/bash 
#----------------------------------------------------------------------------------------------------------------------#
STOP=5
#----------------------------------------------------------------------------------------------------------------------#
#sleep $(( $$ % 55 ))
#----------------------------------------------------------------------------------------------------------------------#

UPTIME=`uptime | awk -F 'load average: ' '{print $2}' | awk -F '.' '{print $1}'`;
echo "Uptime = " $UPTIME

if [ $UPTIME -ge $STOP ]; then
    
    killall --wait -u spider
    reboot
fi

#----------------------------------------------------------------------------------------------------------------------#
# ps -eo pid,etime,args | grep mapper.pl | perl -ane '($h,$m,$s)=split /:/,$F[1]; system("kill -9 $F[0]") if ($h > 50);'
# ps -eo pid,etime,args | grep curl | perl -ane '($h,$m,$s)=split /:/,$F[1]; system("kill -9 $F[0]") if ($h > 0);'
# ps -eo pid,etime,args | grep lynx | perl -ane '($h,$m,$s)=split /:/,$F[1]; system("kill -9 $F[0]") if ($h > 0);'
#----------------------------------------------------------------------------------------------------------------------#
